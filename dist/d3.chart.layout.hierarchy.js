!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("d3"),require("d3.chart")):"function"==typeof define&&define.amd?define("d3.chart.layout.hierarchy",["d3","d3.chart"],e):"object"==typeof exports?exports["d3.chart.layout.hierarchy"]=e(require("d3"),require("d3.chart")):t["d3.chart.layout.hierarchy"]=e(t.d3,t["d3.chart"])}(window,function(t,e){return function(t){var e={};function r(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:n})},r.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=2)}([function(e,r){e.exports=t},function(t,r){t.exports=e},function(t,e,r){"use strict";r.r(e);var n=r(0);r(1);n.chart("hierarchy",{initialize:function(){var t=this;t.d3={},t.layers={},this._features={},t.base.attr("width")||t.base.attr("width",this.base.node().parentElement.clientWidth),t.base.attr("height")||t.base.attr("height",this.base.node().parentElement.clientHeight),t.d3.zoom=n.behavior.zoom(),t.layers.base=t.base.append("g"),t.name(t._name||"name"),t.value(t._value||"value"),t.duration(t._duration||750),t.on("change:value",function(){t.d3.layout.value(function(e){return"_COUNT"===t._value?1:e[t._value]})}),t.walker=function(e,r,n){if(e){r(e);var i=n(e);if(i)for(var a=i.length,o=0;o<a;o++)t.walker(i[o],r,n)}}},name:function(t){return arguments.length?(this._name=t,this.trigger("change:name"),this.root&&this.draw(this.root),this):this._name},value:function(t){return arguments.length?(this._value=t,this.trigger("change:value"),this.root&&this.draw(this.root),this):this._value},duration:function(t){return arguments.length?(this._duration=t,this.trigger("change:duration"),this.root&&this.draw(this.root),this):this._duration},zoomable:function(t){var e=this,r=t||[0,1/0];return e.base.call(e.d3.zoom.scaleExtent(r).on("zoom",function(){e.layers.base.attr("transform","translate("+n.event.translate+") scale("+n.event.scale+")")})),e},sort:function(t){var e=this;return"_ASC"===t?e.d3.layout.sort(function(t,r){return n.ascending(t[e._name],r[e._name])}):"_DESC"===t?e.d3.layout.sort(function(t,r){return n.descending(t[e._name],r[e._name])}):e.d3.layout.sort(t),e},_isFeatureEnabled:function(t){return this._features[t]},_setFeatureEnabled:function(t,e){this._features[t]=e}}),n.chart("hierarchy").extend("cluster-tree",{initialize:function(){var t=this,e=0;t.radius(t._radius||4.5),t._width=t.base.attr("width"),t._height=t.base.attr("height"),t.layers.links=t.layers.base.append("g").classed("links",!0),t.layers.nodes=t.layers.base.append("g").classed("nodes",!0),t.layer("nodes",t.layers.nodes,{dataBind:function(t){return this.selectAll(".node").data(t,function(t){return t._id||(t._id=++e)})},insert:function(){return this.append("g").classed("node",!0)},events:{enter:function(){t._initNode(this),this.append("circle").attr("r",0),this.append("text").attr("dy",".35em").text(function(e){return e[t._name]}).style("fill-opacity",0),this.on("click",function(e){t.trigger("click:node",e)})},merge:function(){t._initNode(this),this.classed("node-collapsed",function(t){return void 0!==t._children}),this.select("text").attr("x",function(t){return t.isLeaf?10:-10}).attr("text-anchor",function(t){return t.isLeaf?"start":"end"})},"merge:transition":function(){this.select("circle").attr("r",t._radius),this.select("text").style("fill-opacity",1)},"exit:transition":function(){this.duration(t._duration).remove(),this.select("circle").attr("r",0),this.select("text").style("fill-opacity",0)}}}),t.layer("links",t.layers.links,{dataBind:function(e){return this.selectAll(".link").data(t.d3.layout.links(e),function(t){return t.target._id})},insert:function(){return this.append("path").classed("link",!0)},events:{enter:function(){this.attr("d",function(e){var r={x:t.source.x0,y:t.source.y0};return t.d3.diagonal({source:r,target:r})})},"merge:transition":function(){this.duration(t._duration).attr("d",t.d3.diagonal).attr("stroke",function(t){return t.source.path&&t.target.path?"#dd7b7b":"#ccc"}).style("stroke-width",function(t){return t.path?1:1.5})},"exit:transition":function(){this.duration(t._duration).attr("d",function(e){var r={x:t.source.x,y:t.source.y};return t.d3.diagonal({source:r,target:r})}).remove()}}})},_initNode:function(t){t.classed("node-leaf",function(t){return t.isLeaf}).classed("node-parent",function(t){return!t.isLeaf})},radius:function(t){return arguments.length?(this._radius="_COUNT"===t?function(t){return t._children?t._children.length:t.children?t.children.length:1}:t,this.trigger("change:radius"),this.root&&this.draw(this.root),this):this._radius},collapsible:function(t){var e=this;if(!this._isFeatureEnabled("collapsible")){this._setFeatureEnabled("collapsible",!0);var r=t;return e.once("collapse:init",function(){void 0!==r&&e.walker(e.root,function(t){t.depth==r&&n(t)},function(t){return t.children&&t.children.length>0&&t.depth<r?t.children:t._children&&t._children.length>0&&t.depth<r?t._children:null})}),e.on("click:node",function(t){t=function(t){t.children?(t._children=t.children,t.children=null):t._children&&(t.children=t._children,t._children=null);return t}(t),e.trigger("transform:stash"),e._internalUpdate=!0,e.draw(t),e._internalUpdate=!1}),e}function n(t){t.children&&(t._children=t.children,t._children.forEach(n),t.children=null)}}}),n.chart("cluster-tree").extend("cluster-tree.cartesian",{initialize:function(){var t=this;t.margin(t._margin||{}),t.levelGap(t._levelGap||"auto"),t.d3.diagonal=n.svg.diagonal().projection(function(t){return[t.y,t.x]}),t.layers.nodes.on("enter",function(){this.attr("transform",function(e){return"translate("+t.source.y0+","+t.source.x0+")"}),this.select("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("text-anchor",function(t){return t.children||t._children?"end":"start"})}),t.layers.nodes.on("merge:transition",function(){this.duration(t._duration).attr("transform",function(t){return"translate("+t.y+","+t.x+")"})}),t.layers.nodes.on("exit:transition",function(){this.attr("transform",function(e){return"translate("+t.source.y+","+t.source.x+")"})}),t.on("change:margin",function(){t._width=t.base.attr("width")-t._margin.left-t._margin.right,t._height=t.base.attr("height")-t._margin.top-t._margin.bottom,t.base.attr("transform","translate("+t._margin.left+","+t._margin.top+")")})},transform:function(t){var e,r=this;return r.source=t,r._internalUpdate||(r.root=t,r.root.x0=r._height/2,r.root.y0=0,e=r._getNodes(),r.trigger("collapse:init")),(e=r._getNodes().reverse()).forEach(function(t){t.isLeaf=!t.children&&!t._children}),r._levelGap&&"auto"!==r._levelGap&&e.forEach(function(t){t.y=t.depth*r._levelGap}),r.on("transform:stash",function(){e.forEach(function(t){t.x0=t.x,t.y0=t.y})}),e},margin:function(t){return arguments.length?(["top","right","bottom","left"].forEach(function(e){e in t&&(this[e]=t[e])},this._margin={top:0,right:0,bottom:0,left:0}),this.trigger("change:margin"),this.root&&this.draw(this.root),this):this._margin},levelGap:function(t){return arguments.length?(this._levelGap=t,this.trigger("change:levelGap"),this.root&&this.draw(this.root),this):this._levelGap},nodeSize:function(t){return arguments.length?(this._nodeSize!==t&&(this._nodeSize=t,this.trigger("change:nodeSize"),this.root&&this.draw(this.root)),this):this._nodeSize},_getNodes:function(t){return this._nodeSize?this.d3.layout.nodeSize(this._nodeSize).nodes(this.root):this.d3.layout.size([this._height,this._width]).nodes(this.root)}}),n.chart("cluster-tree.cartesian").extend("tree.cartesian",{initialize:function(){this.d3.layout=n.layout.tree()}}),n.chart("cluster-tree").extend("cluster-tree.radial",{initialize:function(){var t=this;t.diameter(t._diameter||Math.min(t._width,t._height)),t.d3.diagonal=n.svg.diagonal.radial().projection(function(t){return[t.y,t.x/180*Math.PI]}),t.d3.zoom.translate([t._diameter/2,t._diameter/2]),t.layers.base.attr("transform","translate("+t._diameter/2+","+t._diameter/2+")"),t.layers.nodes.on("enter",function(){this.attr("transform",function(e){return"rotate("+(t.source.x0-90)+")translate("+t.source.y0+")"}),this.select("text").attr("text-anchor",function(t){return t.x<180?"start":"end"}).attr("transform",function(t){return t.x<180?"translate(8)":"rotate(180)translate(-8)"})}),t.layers.nodes.on("merge:transition",function(){this.duration(t._duration).attr("transform",function(t){return"rotate("+(t.x-90)+")translate("+t.y+")"})}),t.layers.nodes.on("exit:transition",function(){this.attr("transform",function(e){return"rotate("+(t.source.x-90)+")translate("+t.source.y+")"})})},transform:function(t){var e;return this.source=t,this._internalUpdate||(this.root=t,this.root.x0=360,this.root.y0=0,e=this.d3.layout.size([360,this._diameter/4]).separation(function(t,e){return 0===t.depth?1:(t.parent==e.parent?1:2)/t.depth}).nodes(this.root),this.trigger("collapse:init")),e=this.d3.layout.nodes(this.root).reverse(),this.on("transform:stash",function(){e.forEach(function(t){t.x0=t.x,t.y0=t.y})}),e},diameter:function(t){return arguments.length?(this._diameter=t,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this._diameter}}),n.chart("cluster-tree.radial").extend("tree.radial",{initialize:function(){this.d3.layout=n.layout.tree()}}),n.chart("hierarchy").extend("treemap",{initialize:function(){var t=this;t.d3.layout=n.layout.treemap(),t._width=t.base.attr("width"),t._height=t.base.attr("height");var e=n.scale.category20c();t.layer("base",t.layers.base,{dataBind:function(t){return this.selectAll(".cell").data(t)},insert:function(){return this.append("g").classed("cell",!0).attr("transform",function(t){return"translate("+t.x+","+t.y+")"})},events:{enter:function(){this.append("rect").attr("width",function(t){return t.dx}).attr("height",function(t){return t.dy}).attr("fill",function(r){return r.parent?e(r.parent[t._name]):null}),this.append("text").attr("x",function(t){return t.dx/2}).attr("y",function(t){return t.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(e){return e.children?null:e[t._name]}).style("opacity",function(t){return t.w=this.getComputedTextLength(),t.dx>t.w?1:0}),this.on("click",function(e){t.trigger("click:node",e)})}}})},transform:function(t){return this.root=t,this.d3.layout.round(!1).size([this._width,this._height]).sticky(!0).nodes(t)},collapsible:function(){var t,e=this,r=n.scale.linear().range([0,e._width]),i=n.scale.linear().range([0,e._height]);return e.layers.base.on("merge",function(){t=e.root,e.on("click:node",function(n){!function(n){var a=e._width/n.dx,o=e._height/n.dy;r.domain([n.x,n.x+n.dx]),i.domain([n.y,n.y+n.dy]);var s=e.layers.base.transition().duration(e._duration);s.selectAll(".cell").attr("transform",function(t){return"translate("+r(t.x)+","+i(t.y)+")"}),s.selectAll("rect").attr("width",function(t){return a*t.dx}).attr("height",function(t){return o*t.dy}),s.selectAll("text").attr("x",function(t){return a*t.dx/2}).attr("y",function(t){return o*t.dy/2}).style("opacity",function(t){return a*t.dx>t.w?1:0}),t=n}(t==n.parent?e.root:n.parent)})}),e}}),n.chart("hierarchy").extend("pack.flattened",{initialize:function(){var t=this;t.d3.layout=n.layout.pack(),t._width=t.base.attr("width"),t._height=t.base.attr("height"),t.flatten(t._flatten||null),t.formats(t._formats||{}),t.diameter(t._diameter||Math.min(t._width,t._height)),t.d3.zoom.translate([(t._width-t._diameter)/2,(t._height-t._diameter)/2]),t.layers.base.attr("transform","translate("+(t._width-t._diameter)/2+","+(t._height-t._diameter)/2+")"),t.layer("base",t.layers.base,{dataBind:function(t){return this.selectAll(".node").data(t.filter(function(t){return!t.children}))},insert:function(){return this.append("g")},events:{enter:function(){this.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),this.append("circle").attr("r",function(t){return t.r}).style("stroke","#aaa").style("fill",t._formats.fill),this.append("text").attr("dy",".3em").style("text-anchor","middle").text(function(e){return e[t._name].substring(0,e.r/3)}),this.append("title").text(t._formats.title),this.on("click",function(e){t.trigger("click:node",e)})}}}),t.on("change:diameter",function(){t.layers.base.attr("transform","translate("+(t._width-t._diameter)/2+","+(t._height-t._diameter)/2+")")})},transform:function(t){return this.root=t,this.d3.layout.size([this._diameter,this._diameter]).sort(null).padding(1.5).nodes(this._flatten?this._flatten(t):t)},diameter:function(t){return arguments.length?(this._diameter=t-10,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this._diameter},flatten:function(t){return arguments.length?(this._flatten=t,this.trigger("change:flatten"),this.root&&this.draw(this.root),this):this._flatten},formats:function(t){if(!arguments.length)return this._formats;var e=this,r=n.scale.category20c();return["title","fill"].forEach(function(e){e in t&&(this[e]=n.functor(t[e]))},this._formats={title:function(t){return t[e._value]},fill:function(t){return r(t[e._name])}}),e.trigger("change:formats"),e.root&&e.draw(e.root),e}}),n.chart("hierarchy").extend("pack.nested",{initialize:function(){var t=this;t.d3.layout=n.layout.pack(),t._width=t.base.attr("width"),t._height=t.base.attr("height"),t.diameter(t._diameter||Math.min(t._width,t._height)),t.d3.zoom.translate([(t._width-t._diameter)/2,(t._height-t._diameter)/2]),t.layers.base.attr("transform","translate("+(t._width-t._diameter)/2+","+(t._height-t._diameter)/2+")"),t.layer("base",t.layers.base,{dataBind:function(t){return this.selectAll(".node").data(t)},insert:function(){return this.append("g")},events:{enter:function(){this.attr("transform",function(t){return"translate("+t.x+","+t.y+")"}),this.append("circle").attr("r",function(t){return t.r}),this.append("text").attr("dy",".3em").style("text-anchor","middle"),this.on("click",function(e){t.trigger("click:node",e)})},merge:function(){this.attr("class",function(t){return t.children?"node parent":"node child"}),this.select("text").style("opacity",function(t){return t.r>20?1:0}).text(function(e){return e[t._name]})}}}),t.on("change:diameter",function(){t.layers.base.attr("transform","translate("+(t._width-t._diameter)/2+","+(t._height-t._diameter)/2+")")})},transform:function(t){return this.root=t,this.d3.layout.size([this._diameter,this._diameter]).nodes(t)},diameter:function(t){return arguments.length?(this._diameter=t-10,this.trigger("change:diameter"),this.root&&this.draw(this.root),this):this._diameter},collapsible:function(){var t,e=this,r=n.scale.linear().range([0,e._diameter]),i=n.scale.linear().range([0,e._diameter]);return e.layers.base.on("merge",function(){t=e.root,e.on("click:node",function(n){!function(n){var a=e._diameter/n.r/2;r.domain([n.x-n.r,n.x+n.r]),i.domain([n.y-n.r,n.y+n.r]);var o=e.layers.base.transition().duration(e._duration);o.selectAll(".node").attr("transform",function(t){return"translate("+r(t.x)+","+i(t.y)+")"}),o.selectAll("circle").attr("r",function(t){return a*t.r}),o.selectAll("text").style("opacity",function(t){return a*t.r>20?1:0}),t=n}(t==n?e.root:n)})}),e}}),n.chart("hierarchy").extend("partition.arc",{initialize:function(){var t=this;t.d3.layout=n.layout.partition(),t._width=t.base.attr("width"),t._height=t.base.attr("height"),t.diameter(t._diameter||Math.min(t._width,t._height)),t.d3.color=n.scale.category20c(),t.d3.x=n.scale.linear().range([0,2*Math.PI]),t.d3.y=n.scale.sqrt().range([0,t._diameter/2]),t.d3.arc=n.svg.arc().startAngle(function(e){return Math.max(0,Math.min(2*Math.PI,t.d3.x(e.x)))}).endAngle(function(e){return Math.max(0,Math.min(2*Math.PI,t.d3.x(e.x+e.dx)))}).innerRadius(function(e){return Math.max(0,t.d3.y(e.y))}).outerRadius(function(e){return Math.max(0,t.d3.y(e.y+e.dy))}),t.d3.zoom.translate([t.base.attr("width")/2,t.base.attr("height")/2]),t.layers.base.attr("transform","translate("+t.base.attr("width")/2+","+t.base.attr("height")/2+")"),t.layer("base",t.layers.base,{dataBind:function(t){return this.selectAll("path").data(t)},insert:function(){return this.append("path")},events:{enter:function(){this.attr("d",t.d3.arc).style("fill",function(e){return t.d3.color((e.children?e:e.parent)[t._name])}),this.on("click",function(e){t.trigger("click:node",e)})}}}),t.on("change:radius",function(){t.layers.paths.attr("transform","translate("+t.base.attr("width")/2+","+t.base.attr("height")/2+")"),t.d3.y=n.scale.sqrt().range([0,t._diameter/2])})},transform:function(t){return this.root=t,this.d3.layout.nodes(t)},diameter:function(t){return arguments.length?(this._diameter=t-10,this.trigger("change:radius"),this.root&&this.draw(this.root),this):this._diameter},collapsible:function(){var t=this;return t.layers.base.on("merge",function(){var e=this;t.on("click:node",function(r){e.transition().duration(t._duration).attrTween("d",function(e){var r=n.interpolate(t.d3.x.domain(),[e.x,e.x+e.dx]),i=n.interpolate(t.d3.y.domain(),[e.y,1]),a=n.interpolate(t.d3.y.range(),[e.y?20:0,t._diameter/2]);return function(e,n){return n?function(r){return t.d3.arc(e)}:function(n){return t.d3.x.domain(r(n)),t.d3.y.domain(i(n)).range(a(n)),t.d3.arc(e)}}}(r))})}),t}}),n.chart("hierarchy").extend("partition.rectangle",{initialize:function(){var t=this;t.d3.layout=n.layout.partition(),t._width=t.base.attr("width"),t._height=t.base.attr("height");var e=n.scale.linear().range([0,t._width]),r=n.scale.linear().range([0,t._height]);t.d3.transform=function(t,e){return"translate(8,"+t.dx*e/2+")"},t.layer("base",t.layers.base,{dataBind:function(t){return this.selectAll(".partition").data(t)},insert:function(){return this.append("g").classed("partition",!0).attr("transform",function(t){return"translate("+e(t.y)+","+r(t.x)+")"})},events:{enter:function(){var e=t._width/t.root.dx,r=t._height/1;this.append("rect").attr("class",function(t){return t.children?"parent":"child"}).attr("width",t.root.dy*e).attr("height",function(t){return t.dx*r}),this.append("text").attr("transform",function(e){return t.d3.transform(e,r)}).attr("dy",".35em").style("opacity",function(t){return t.dx*r>12?1:0}).text(function(e){return e[t._name]}),this.on("click",function(e){t.trigger("click:node",e)})}}})},transform:function(t){return this.root=t,this.d3.layout.nodes(t)},collapsible:function(){var t,e=this,r=n.scale.linear(),i=n.scale.linear().range([0,e._height]);return e.layers.base.on("merge",function(){t=e.root,e.on("click:node",function(n){!function(n){var a=(n.y?e._width-40:e._width)/(1-n.y),o=e._height/n.dx;r.domain([n.y,1]).range([n.y?40:0,e._width]),i.domain([n.x,n.x+n.dx]);var s=e.layers.base.transition().duration(e._duration);s.selectAll(".partition").attr("transform",function(t){return"translate("+r(t.y)+","+i(t.x)+")"}),s.selectAll("rect").attr("width",n.dy*a).attr("height",function(t){return t.dx*o}),s.selectAll("text").attr("transform",function(t){return e.d3.transform(t,o)}).style("opacity",function(t){return t.dx*o>12?1:0}),t=n}(t==n?e.root:n)})}),e}})}])});
//# sourceMappingURL=d3.chart.layout.hierarchy.js.map